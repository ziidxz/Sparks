# Naruto character cards
cards_list = [
    {
        "name": "Naruto Uzumaki",
        "attack": 130,
        "defense": 90,
        "speed": 100,
        "element": "Wind",
        "rarity": "Legendary",
        "skill": "Rasengan",
        "skill_description": "Creates a spiraling sphere of chakra that deals massive damage and has a 30% chance to stun.",
        "skill_mp_cost": 35,
        "skill_cooldown": 3,
        "critical_rate": 15.0,
        "dodge_rate": 10.0,
        "lore": "The Number One Hyperactive, Knucklehead Ninja who dreams of becoming Hokage.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/naruto.png",
        "evolvable": 1
    },
    {
        "name": "Sasuke Uchiha",
        "attack": 140,
        "defense": 85,
        "speed": 110,
        "element": "Fire",
        "rarity": "Legendary",
        "skill": "Chidori",
        "skill_description": "Channels lightning chakra into hand to pierce through enemies with high critical rate.",
        "skill_mp_cost": 30,
        "skill_cooldown": 3,
        "critical_rate": 20.0,
        "dodge_rate": 8.0,
        "lore": "The last surviving member of the Uchiha clan, seeking power to avenge his family.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/sasuke.png",
        "evolvable": 1
    },
    {
        "name": "Sakura Haruno",
        "attack": 100,
        "defense": 95,
        "speed": 90,
        "element": "Earth",
        "rarity": "Epic",
        "skill": "Cherry Blossom Impact",
        "skill_description": "Channels chakra into fists to deliver devastating blows and heal 20% HP.",
        "skill_mp_cost": 25,
        "skill_cooldown": 3,
        "critical_rate": 10.0,
        "dodge_rate": 12.0,
        "lore": "A medical ninja with incredible strength and healing abilities, trained by Tsunade.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/sakura.png",
        "evolvable": 1
    },
    {
        "name": "Kakashi Hatake",
        "attack": 120,
        "defense": 100,
        "speed": 115,
        "element": "Lightning",
        "rarity": "Epic",
        "skill": "Lightning Blade",
        "skill_description": "A more concentrated form of Chidori that deals high damage with improved accuracy.",
        "skill_mp_cost": 30,
        "skill_cooldown": 3,
        "critical_rate": 15.0,
        "dodge_rate": 15.0,
        "lore": "The Copy Ninja who has mastered over a thousand jutsu with his Sharingan eye.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/kakashi.png",
        "evolvable": 1
    },
    {
        "name": "Hinata Hyuga",
        "attack": 90,
        "defense": 85,
        "speed": 95,
        "element": "Water",
        "rarity": "Rare",
        "skill": "Gentle Fist",
        "skill_description": "Targets chakra points to disable opponent's abilities and reduce their attack power.",
        "skill_mp_cost": 20,
        "skill_cooldown": 2,
        "critical_rate": 10.0,
        "dodge_rate": 15.0,
        "lore": "A member of the Hyuga clan who overcame her shyness to become a formidable ninja.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/hinata.png",
        "evolvable": 1
    },
    {
        "name": "Rock Lee",
        "attack": 130,
        "defense": 70,
        "speed": 140,
        "element": "Earth",
        "rarity": "Rare",
        "skill": "Primary Lotus",
        "skill_description": "Removes all limitations on the body to perform a devastating attack at the cost of HP.",
        "skill_mp_cost": 15,
        "skill_cooldown": 4,
        "critical_rate": 15.0,
        "dodge_rate": 20.0,
        "lore": "A taijutsu specialist who can't use ninjutsu but makes up for it with hard work and dedication.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/lee.png",
        "evolvable": 1
    },
    {
        "name": "Gaara",
        "attack": 110,
        "defense": 140,
        "speed": 80,
        "element": "Earth",
        "rarity": "Epic",
        "skill": "Sand Coffin",
        "skill_description": "Encases opponents in sand and crushes them, dealing damage over 3 turns.",
        "skill_mp_cost": 35,
        "skill_cooldown": 4,
        "critical_rate": 8.0,
        "dodge_rate": 5.0,
        "lore": "The Kazekage of the Sand Village and former host of the One-Tailed Beast, Shukaku.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/gaara.png",
        "evolvable": 1
    },
    {
        "name": "Itachi Uchiha",
        "attack": 150,
        "defense": 90,
        "speed": 120,
        "element": "Fire",
        "rarity": "Legendary",
        "skill": "Tsukuyomi",
        "skill_description": "Traps opponent in a genjutsu that deals mental damage and stuns for 2 turns.",
        "skill_mp_cost": 40,
        "skill_cooldown": 5,
        "critical_rate": 20.0,
        "dodge_rate": 10.0,
        "lore": "A prodigy of the Uchiha clan who sacrificed everything to protect his village and brother.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/itachi.png",
        "evolvable": 1
    },
    {
        "name": "Jiraiya",
        "attack": 135,
        "defense": 95,
        "speed": 90,
        "element": "Fire",
        "rarity": "Epic",
        "skill": "Toad Oil Flame Bullet",
        "skill_description": "Combines oil and fire to create a massive flamethrower attack that burns for 3 turns.",
        "skill_mp_cost": 35,
        "skill_cooldown": 4,
        "critical_rate": 15.0,
        "dodge_rate": 10.0,
        "lore": "One of the Legendary Sannin and Naruto's mentor, known as the Toad Sage.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/jiraiya.png",
        "evolvable": 1
    },
    {
        "name": "Tsunade",
        "attack": 120,
        "defense": 110,
        "speed": 85,
        "element": "Earth",
        "rarity": "Epic",
        "skill": "Creation Rebirth",
        "skill_description": "Uses stored chakra to heal all wounds and greatly boost attack for 3 turns.",
        "skill_mp_cost": 40,
        "skill_cooldown": 5,
        "critical_rate": 10.0,
        "dodge_rate": 12.0,
        "lore": "One of the Legendary Sannin and the Fifth Hokage, renowned for her medical jutsu and strength.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/tsunade.png",
        "evolvable": 1
    },
    {
        "name": "Orochimaru",
        "attack": 130,
        "defense": 100,
        "speed": 95,
        "element": "Dark",
        "rarity": "Epic",
        "skill": "Eight Branches Technique",
        "skill_description": "Transforms into a massive white serpent with 8 heads, dealing damage to all opponents.",
        "skill_mp_cost": 35,
        "skill_cooldown": 4,
        "critical_rate": 12.0,
        "dodge_rate": 15.0,
        "lore": "A former Leaf ninja and one of the Legendary Sannin obsessed with learning all jutsu and achieving immortality.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/orochimaru.png",
        "evolvable": 1
    },
    {
        "name": "Neji Hyuga",
        "attack": 110,
        "defense": 95,
        "speed": 105,
        "element": "Air",
        "rarity": "Rare",
        "skill": "Eight Trigrams Palms",
        "skill_description": "Strikes 64 chakra points, reducing opponent's attack and defense for 2 turns.",
        "skill_mp_cost": 25,
        "skill_cooldown": 3,
        "critical_rate": 15.0,
        "dodge_rate": 15.0,
        "lore": "A prodigy of the Hyuga clan's branch family who overcame his resentment of the main branch.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/neji.png",
        "evolvable": 1
    },
    {
        "name": "Shikamaru Nara",
        "attack": 80,
        "defense": 90,
        "speed": 85,
        "element": "Dark",
        "rarity": "Rare",
        "skill": "Shadow Possession",
        "skill_description": "Extends shadow to capture opponent, stunning them and reflecting 50% of damage.",
        "skill_mp_cost": 20,
        "skill_cooldown": 3,
        "critical_rate": 8.0,
        "dodge_rate": 10.0,
        "lore": "A lazy but brilliant strategist from the Nara clan with an IQ over 200.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/shikamaru.png",
        "evolvable": 1
    },
    {
        "name": "Might Guy",
        "attack": 150,
        "defense": 80,
        "speed": 130,
        "element": "Earth",
        "rarity": "Epic",
        "skill": "Night Guy",
        "skill_description": "Opens the Eight Gates to perform an incredibly powerful kick at the cost of health.",
        "skill_mp_cost": 50,
        "skill_cooldown": 6,
        "critical_rate": 25.0,
        "dodge_rate": 10.0,
        "lore": "The Leaf Village's foremost taijutsu expert and eternal rival of Kakashi Hatake.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/mightguy.png",
        "evolvable": 1
    },
    {
        "name": "Madara Uchiha",
        "attack": 170,
        "defense": 140,
        "speed": 130,
        "element": "Fire",
        "rarity": "Legendary",
        "skill": "Perfect Susanoo",
        "skill_description": "Manifests a gigantic avatar of chakra that delivers devastating attacks for 3 turns.",
        "skill_mp_cost": 60,
        "skill_cooldown": 6,
        "critical_rate": 25.0,
        "dodge_rate": 15.0,
        "lore": "One of the most powerful Uchiha to ever live and co-founder of the Hidden Leaf Village.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/madara.png",
        "evolvable": 1
    },
    {
        "name": "Naruto Uzumaki - Six Paths Sage",
        "attack": 200,
        "defense": 180,
        "speed": 190,
        "element": "Light",
        "rarity": "Legendary",
        "skill": "Six Paths: Ultra-Big Ball Rasenshuriken",
        "skill_description": "Combines nature energy with Six Paths power to create multiple elemental Rasenshuriken that deal massive damage.",
        "skill_mp_cost": 80,
        "skill_cooldown": 7,
        "critical_rate": 30.0,
        "dodge_rate": 25.0,
        "lore": "Naruto after receiving the Six Paths Sage power from Hagoromo Otsutsuki, capable of using all chakra natures.",
        "image_url": "https://cdn.discordapp.com/attachments/123456789/123456789/naruto_sage.png",
        "evolvable": 0
    }
]

# Store evolution data
evolution_data = {
    # Base cards that can evolve, with their evolution requirements and results
    "Naruto Uzumaki": {
        "base_card_id": 1,  # Matches the position in cards_list (0-indexed)
        "stages": {
            # Stage 0 to 1 evolution
            0: {
                "materials": [
                    {"material_id": 8, "quantity": 3},  # Elemental Core: Earth
                    {"material_id": 3, "quantity": 5}   # Star Fragment
                ],
                "gold_cost": 3000,
                "result": {
                    "new_name": "Naruto Uzumaki - Sage Mode",
                    "attack_boost": 20,
                    "defense_boost": 15,
                    "speed_boost": 15,
                    "new_skill": "Sage Art: Massive Rasengan",
                    "new_skill_description": "Combines nature energy with a Rasengan to create a larger, more powerful version that deals massive damage.",
                    "new_image_url": None
                }
            },
            # Stage 1 to 2 evolution
            1: {
                "materials": [
                    {"material_id": 9, "quantity": 3},  # Elemental Core: Air
                    {"material_id": 10, "quantity": 5}, # Elemental Core: Light
                    {"material_id": 5, "quantity": 2}   # Cosmic Dust
                ],
                "gold_cost": 8000,
                "result": {
                    "new_name": "Naruto Uzumaki - Six Paths Sage",
                    "attack_boost": 70,
                    "defense_boost": 90,
                    "speed_boost": 90,
                    "new_skill": "Six Paths: Ultra-Big Ball Rasenshuriken",
                    "new_skill_description": "Combines nature energy with Six Paths power to create multiple elemental Rasenshuriken that deal massive damage.",
                    "new_image_url": None
                }
            }
        }
    },
    "Sasuke Uchiha": {
        "base_card_id": 2,
        "stages": {
            0: {
                "materials": [
                    {"material_id": 6, "quantity": 3},  # Elemental Core: Fire
                    {"material_id": 3, "quantity": 5}   # Star Fragment
                ],
                "gold_cost": 3000,
                "result": {
                    "new_name": "Sasuke Uchiha - Mangekyo Sharingan",
                    "attack_boost": 25,
                    "defense_boost": 10,
                    "speed_boost": 15,
                    "new_skill": "Amaterasu",
                    "new_skill_description": "Creates black flames that cannot be extinguished and burn targets for 3 turns.",
                    "new_image_url": None
                }
            },
            1: {
                "materials": [
                    {"material_id": 6, "quantity": 5},  # Elemental Core: Fire
                    {"material_id": 11, "quantity": 3}, # Elemental Core: Dark
                    {"material_id": 5, "quantity": 2}   # Cosmic Dust
                ],
                "gold_cost": 8000,
                "result": {
                    "new_name": "Sasuke Uchiha - Rinnegan",
                    "attack_boost": 60,
                    "defense_boost": 80,
                    "speed_boost": 60,
                    "new_skill": "Indra's Arrow",
                    "new_skill_description": "Combines all chakra into a lightning arrow that pierces all defenses, dealing massive damage with guaranteed critical hit.",
                    "new_image_url": None
                }
            }
        }
    },
    "Itachi Uchiha": {
        "base_card_id": 8,
        "stages": {
            0: {
                "materials": [
                    {"material_id": 6, "quantity": 5},  # Elemental Core: Fire
                    {"material_id": 11, "quantity": 3}, # Elemental Core: Dark
                    {"material_id": 4, "quantity": 1}   # Dragon Scale
                ],
                "gold_cost": 5000,
                "result": {
                    "new_name": "Itachi Uchiha - Susanoo",
                    "attack_boost": 40,
                    "defense_boost": 50,
                    "speed_boost": 10,
                    "new_skill": "Totsuka Blade",
                    "new_skill_description": "Wields the Sword of Totsuka through Susanoo, which seals anything it pierces and negates enemy skills for 2 turns.",
                    "new_image_url": None
                }
            }
        }
    }
}

# Function to be called when module is initialized
async def setup(bot):
    # Access the database to set up evolutions
    db = bot.db
    cursor = db.conn.cursor()
    
    # Function to process all defined evolutions
    def process_evolutions():
        for card_name, evo_data in evolution_data.items():
            base_card_id = evo_data["base_card_id"] + 17  # Adjust for 1-indexed database and offset (16 cards in cards1.py)
            
            # Mark the card as evolvable in the cards table
            cursor.execute("""
                UPDATE cards SET evolvable = 1 WHERE id = ?
            """, (base_card_id,))
            
            # Process each stage's requirements and results
            for stage, stage_data in evo_data["stages"].items():
                # Add evolution requirements
                for material in stage_data["materials"]:
                    cursor.execute("""
                        INSERT OR REPLACE INTO evolution_requirements
                        (base_card_id, evolution_stage, material_id, quantity, gold_cost)
                        VALUES (?, ?, ?, ?, ?)
                    """, (
                        base_card_id,
                        stage,
                        material["material_id"],
                        material["quantity"],
                        stage_data["gold_cost"]
                    ))
                
                # Add evolution results
                result = stage_data["result"]
                cursor.execute("""
                    INSERT OR REPLACE INTO evolution_results
                    (base_card_id, evolution_stage, new_name, attack_boost, defense_boost, 
                     speed_boost, new_skill, new_skill_description, new_image_url)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
                """, (
                    base_card_id,
                    stage,
                    result["new_name"],
                    result["attack_boost"],
                    result["defense_boost"],
                    result["speed_boost"],
                    result["new_skill"],
                    result["new_skill_description"],
                    result["new_image_url"]
                ))
    
    # Insert cards into database if they don't exist
    for i, card in enumerate(cards_list, 17):  # Start from 17 (after cards1.py)
        cursor.execute("""
            INSERT OR IGNORE INTO cards
            (id, name, rarity, attack, defense, speed, element, skill, skill_description,
             skill_mp_cost, skill_cooldown, critical_rate, dodge_rate, lore, image_url, evolvable)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        """, (
            i,
            card["name"],
            card["rarity"],
            card["attack"],
            card["defense"],
            card["speed"],
            card["element"],
            card["skill"],
            card["skill_description"],
            card["skill_mp_cost"],
            card["skill_cooldown"],
            card["critical_rate"],
            card["dodge_rate"],
            card["lore"],
            card["image_url"],
            card["evolvable"]
        ))
    
    # Process all evolutions
    process_evolutions()
    
    # Commit changes
    db.conn.commit()
